<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> {% block title %} E-Commerce #1 {% endblock %}</title>
    {% load static %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">
    <link href="{% static 'template-styles.css'%}" rel="stylesheet">
</head>
<body>
{% include 'main/headerMob.html' with user=request.user %}
<p> МОБИЛЬНАЯ ВЕРСИЯ САЙТА </p>
<div>
  <p>Проверить наличие товара</p>
  <input type = "text" id = "good_amount_field">
  <button onClick = "check_good_amount()">Get</button>
  <p id = "message"></p>
</div>
<main role="main" class="container">

  <div class="starter-template">
    <h1>{% block page_header %} Welcome to the best E-Commerce market {% endblock %}</h1>
    <p class="lead">{% block page_content %} There will be content soon... {% endblock %}</p>
  </div>

</main>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script>
  function check_good_amount() {
    lo = new WebSocket("ws://localhost:8000/ws/chat");



    waitForSocketConnection(lo, name)
    }

    function waitForSocketConnection(socket, name, callback){
    setTimeout(
        function () {
            if (socket.readyState === 1) {
                name = document.querySelector('#good_amount_field').value;
                lo.onmessage = (data) => {
                message = JSON.parse(data['data'])['message']
                document.querySelector('#message').innerHTML = message
                };
                lo.send(JSON.stringify({"good_name": name}))
                if (callback != null){
                    callback();
                }
            } else {
                waitForSocketConnection(socket, callback);
            }

        }, 5); // wait 5 milisecond for the connection...
}


  </script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
</body>
</html>